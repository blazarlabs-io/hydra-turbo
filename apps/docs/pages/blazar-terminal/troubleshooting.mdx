# Troubleshooting

Common issues and solutions for the Blazar Terminal.

## BLE Issues

### BLE Not Advertising

**Symptoms**: Terminal not discoverable by mobile devices

**Solutions**:
```bash
# Check Bluetooth status
sudo systemctl status bluetooth

# Restart Bluetooth service
sudo systemctl restart bluetooth

# Check BLE capabilities
sudo setcap cap_net_raw+eip $(which node)

# Verify Bluetooth is enabled
sudo hciconfig hci0 up
sudo hciconfig hci0 piscan
```

### BLE Connection Failed

**Symptoms**: Mobile devices cannot connect to terminal

**Solutions**:
```bash
# Reset Bluetooth adapter
sudo hciconfig hci0 reset

# Check Bluetooth logs
sudo journalctl -u bluetooth -f

# Verify service UUID
sudo hcitool lescan
```

### BLE Permission Denied

**Symptoms**: Permission errors when accessing Bluetooth

**Solutions**:
```bash
# Add user to bluetooth group
sudo usermod -a -G bluetooth $USER

# Set Node.js capabilities
sudo setcap cap_net_raw+eip $(which node)

# Logout and login again
logout
```

## WebSocket Issues

### WebSocket Connection Failed

**Symptoms**: Merchant apps cannot connect to terminal

**Solutions**:
```bash
# Check if port 3000 is available
netstat -tulpn | grep :3000

# Check firewall settings
sudo ufw status

# Test WebSocket server
curl -I http://localhost:3000

# Check service status
sudo systemctl status blazar-terminal
```

### WebSocket CORS Errors

**Symptoms**: CORS errors in browser console

**Solutions**:
```javascript
// Update CORS configuration in src/socket.js
const io = new Server(server, {
  cors: {
    origin: "http://your-merchant-app.com", // Update this
    methods: ["GET", "POST"],
  },
});
```

## API Issues

### API Connection Failed

**Symptoms**: Terminal cannot connect to Blazar API

**Solutions**:
```bash
# Test API connectivity
curl -I https://api.blazarpay.com

# Check network connectivity
ping -c 4 8.8.8.8

# Verify API_BASE_URL
grep API_BASE_URL src/services.js

# Check DNS resolution
nslookup api.blazarpay.com
```

### API Authentication Failed

**Symptoms**: 401/403 errors from API

**Solutions**:
```bash
# Check API key configuration
grep API_KEY src/services.js

# Verify API endpoint
curl -H "Authorization: Bearer YOUR_API_KEY" https://api.blazarpay.com/health
```

## Service Issues

### Service Won't Start

**Symptoms**: Blazar Terminal service fails to start

**Solutions**:
```bash
# Check service status
sudo systemctl status blazar-terminal.service

# Check service logs
sudo journalctl -u blazar-terminal.service -f

# Check service configuration
sudo systemctl cat blazar-terminal.service

# Restart service
sudo systemctl restart blazar-terminal.service
```

### Service Crashes

**Symptoms**: Service starts but crashes repeatedly

**Solutions**:
```bash
# Check system resources
free -h
df -h

# Check system logs
sudo journalctl -u blazar-terminal.service --since "1 hour ago"

# Check Node.js version
node --version

# Verify dependencies
npm list
```

## Network Issues

### Wi-Fi Connection Problems

**Symptoms**: Terminal cannot connect to Wi-Fi

**Solutions**:
```bash
# Check Wi-Fi status
sudo systemctl status networking

# Check Wi-Fi configuration
sudo nano /etc/wpa_supplicant/wpa_supplicant.conf

# Restart networking
sudo systemctl restart networking

# Check IP address
ip addr show
```

### Port Conflicts

**Symptoms**: Port 3000 already in use

**Solutions**:
```bash
# Find process using port 3000
sudo lsof -i :3000

# Kill process using port 3000
sudo kill -9 $(sudo lsof -t -i:3000)

# Check if another instance is running
ps aux | grep node
```

## Performance Issues

### High CPU Usage

**Symptoms**: Terminal using excessive CPU

**Solutions**:
```bash
# Check CPU usage
htop

# Check system temperature
vcgencmd measure_temp

# Check for runaway processes
ps aux --sort=-%cpu | head -10

# Restart service
sudo systemctl restart blazar-terminal
```

### Memory Issues

**Symptoms**: High memory usage or out of memory errors

**Solutions**:
```bash
# Check memory usage
free -h

# Check memory by process
ps aux --sort=-%mem | head -10

# Check swap usage
swapon --show

# Increase swap if needed
sudo dphys-swapfile swapoff
sudo nano /etc/dphys-swapfile
# Set CONF_SWAPSIZE=1024
sudo dphys-swapfile setup
sudo dphys-swapfile swapon
```

## Hardware Issues

### Power Problems

**Symptoms**: Terminal shuts down unexpectedly

**Solutions**:
```bash
# Check power supply
vcgencmd get_throttled

# Check system temperature
vcgencmd measure_temp

# Check power logs
dmesg | grep -i power
```

### SD Card Issues

**Symptoms**: Boot failures or data corruption

**Solutions**:
```bash
# Check disk health
sudo fsck /dev/mmcblk0p2

# Check disk usage
df -h

# Check disk errors
sudo dmesg | grep -i error
```

## Debug Commands

### System Information

```bash
# System information
uname -a
cat /proc/cpuinfo
free -h
df -h

# Bluetooth information
bluetoothctl --version
hciconfig --version

# Node.js information
node --version
npm --version
```

### Service Status

```bash
# Check all services
sudo systemctl status bluetooth
sudo systemctl status blazar-terminal
sudo systemctl status networking

# Check service dependencies
systemctl list-dependencies blazar-terminal.service
```

### Network Diagnostics

```bash
# Network configuration
ip addr show
ip route show

# Network connectivity
ping -c 4 8.8.8.8
ping -c 4 api.blazarpay.com

# Port scanning
nmap -p 3000 localhost
```

### Bluetooth Diagnostics

```bash
# Bluetooth status
sudo hciconfig hci0
sudo hcitool dev

# BLE scanning
sudo hcitool lescan

# Bluetooth logs
sudo journalctl -u bluetooth -f
```

## Log Analysis

### Service Logs

```bash
# View service logs
sudo journalctl -u blazar-terminal.service -f

# View recent logs
sudo journalctl -u blazar-terminal.service --since "1 hour ago"

# View logs with timestamps
sudo journalctl -u blazar-terminal.service --since "2024-01-01" --until "2024-01-02"
```

### Application Logs

```bash
# View application logs
tail -f /opt/blazar-terminal/logs/app.log

# View error logs
tail -f /opt/blazar-terminal/logs/error.log

# Search logs
grep "ERROR" /opt/blazar-terminal/logs/*.log
```

### System Logs

```bash
# View system logs
sudo journalctl -f

# View kernel logs
dmesg | tail -20

# View boot logs
sudo journalctl -b
```

## Recovery Procedures

### Complete Reset

If the terminal is completely unresponsive:

```bash
# Stop all services
sudo systemctl stop blazar-terminal
sudo systemctl stop bluetooth

# Clear logs
sudo journalctl --vacuum-time=1d

# Restart services
sudo systemctl start bluetooth
sudo systemctl start blazar-terminal
```

### Reinstall Application

If the application is corrupted:

```bash
# Stop service
sudo systemctl stop blazar-terminal

# Backup configuration
sudo cp -r /opt/blazar-terminal /opt/blazar-terminal.backup

# Reinstall application
cd /opt
sudo rm -rf blazar-terminal
sudo git clone <repo-url> blazar-terminal
cd blazar-terminal
npm install

# Restore configuration
sudo cp /opt/blazar-terminal.backup/config/* /opt/blazar-terminal/config/

# Restart service
sudo systemctl start blazar-terminal
```

### Factory Reset

For complete factory reset:

```bash
# Stop all services
sudo systemctl stop blazar-terminal
sudo systemctl stop bluetooth

# Remove application
sudo rm -rf /opt/blazar-terminal

# Remove service file
sudo rm /etc/systemd/system/blazar-terminal.service

# Reload systemd
sudo systemctl daemon-reload

# Follow installation guide again
```

## Getting Help

### Log Collection

When reporting issues, collect these logs:

```bash
# System information
uname -a > system-info.txt
free -h >> system-info.txt
df -h >> system-info.txt

# Service status
sudo systemctl status blazar-terminal >> service-status.txt
sudo systemctl status bluetooth >> service-status.txt

# Recent logs
sudo journalctl -u blazar-terminal.service --since "1 hour ago" > recent-logs.txt
```

### Support Channels

- **GitHub Issues**: [Report bugs](https://github.com/blazarpay/docs/issues)
- **Documentation**: [Browse docs](https://docs.blazarpay.com)
- **Community**: [GitHub Discussions](https://github.com/blazarpay/docs/discussions)
- **Email**: [docs@blazarpay.com](mailto:docs@blazarpay.com)

## Next Steps

- **[Development](/blazar-terminal/development)** - Development guidelines
- **[Usage Guide](/blazar-terminal/usage-guide)** - Usage instructions
- **[API Integration](/blazar-terminal/api-integration)** - Backend API integration
- **[Payment Flow](/blazar-terminal/payment-flow)** - Payment processing flow
