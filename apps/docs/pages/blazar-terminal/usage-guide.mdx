# Usage Guide

This guide covers how to use the Blazar Terminal for processing payments and managing merchant applications.

## Running the Terminal

### Development Mode

```bash
# Start in development mode with auto-restart
npm run dev

# Or start with nodemon
nodemon src/index.js
```

### Production Mode

```bash
# Start in production mode
node src/index.js

# Or use PM2 for process management
pm2 start ecosystem.config.js
```

### Service Management

```bash
# Start the service
sudo systemctl start blazar-terminal

# Stop the service
sudo systemctl stop blazar-terminal

# Restart the service
sudo systemctl restart blazar-terminal

# Check service status
sudo systemctl status blazar-terminal

# View service logs
sudo journalctl -u blazar-terminal.service -f
```

## Merchant Integration

### WebSocket Connection

Connect your merchant application to the Blazar Terminal:

```javascript
const io = require('socket.io-client');

// Connect to terminal WebSocket
const socket = io('http://terminal-ip:3000');

socket.on('connect', () => {
  console.log('Connected to Blazar Terminal');
});

socket.on('payed', (paymentData) => {
  console.log('Payment received:', paymentData);
  // Handle payment completion
});

socket.on('disconnect', () => {
  console.log('Disconnected from terminal');
});
```

### Payment Request

Initiate a payment request:

```javascript
// Request payment from terminal
socket.emit('requestFunds', {
  address: 'merchant_cardano_address',
  amount: 10.5,
  decimals: 6,
  assetUnit: 'lovelace'
});
```

### Payment Confirmation

Handle payment completion:

```javascript
socket.on('payed', (paymentData) => {
  console.log('Payment Details:', {
    clientAddress: paymentData.clientAddress,
    merchantAddress: paymentData.merchantAddress,
    amount: paymentData.amount,
    transactionId: paymentData.transactionId
  });
  
  // Update your system with payment confirmation
  updateOrderStatus(paymentData.transactionId, 'paid');
});
```

## Mobile Wallet Integration

### BLE Discovery

Mobile wallets can discover Blazar Terminals:

```javascript
import { BleManager } from 'react-native-ble-plx';

const bleManager = new BleManager();

// Scan for Blazar Terminals
bleManager.startDeviceScan(
  ['1d4ddcb2-279d-42e2-a95a-274352a25248'], // Service UUID
  null,
  (error, device) => {
    if (device && device.name === 'Blazar TERM') {
      console.log('Found Blazar Terminal:', device.id);
      connectToTerminal(device);
    }
  }
);
```

### Payment Processing

Process payments through mobile wallet:

```javascript
async function processPayment(device, clientAddress) {
  try {
    // Connect to device
    await device.connect();
    await device.discoverAllServicesAndCharacteristics();
    
    // Get payment service
    const service = await device.getService('1d4ddcb2-279d-42e2-a95a-274352a25248');
    
    // Read payment details
    const merchantAddress = await readCharacteristic(service, 'a781af9a-9a04-4422-9d78-9014497ccdc0');
    const amount = await readCharacteristic(service, '61b64163-35fa-438a-810c-018d1a719667');
    const assetUnit = await readCharacteristic(service, '52f34145-0363-4f4e-9fab-a133e8e5b0b1');
    
    // Display payment details to user
    const confirmed = await confirmPayment({
      merchant: merchantAddress,
      amount: amount,
      asset: assetUnit
    });
    
    if (confirmed) {
      // Write client address to authorize payment
      const clientChar = await service.getCharacteristic('9b16159d-7c3e-4ae6-990b-0d34f22389bb');
      await clientChar.writeWithResponse(Buffer.from(clientAddress, 'utf8'));
      
      console.log('Payment authorized');
    }
    
  } catch (error) {
    console.error('Payment failed:', error);
  }
}
```

## Monitoring and Logs

### System Monitoring

Monitor terminal performance:

```bash
# Check system resources
htop

# Monitor network connections
netstat -tulpn

# Check Bluetooth status
sudo systemctl status bluetooth

# Monitor WebSocket connections
netstat -tulpn | grep :3000
```

### Application Logs

View application logs:

```bash
# View service logs
sudo journalctl -u blazar-terminal.service -f

# View recent logs
sudo journalctl -u blazar-terminal.service --since "1 hour ago"

# View application logs
tail -f /opt/blazar-terminal/logs/app.log

# View error logs
tail -f /opt/blazar-terminal/logs/error.log
```

### BLE Monitoring

Monitor BLE activity:

```bash
# Check Bluetooth devices
sudo hcitool dev

# Scan for BLE devices
sudo hcitool lescan

# Monitor Bluetooth logs
sudo journalctl -u bluetooth -f
```

## Configuration

### API Configuration

Configure API endpoints:

```javascript
// Edit src/services.js
const API_BASE_URL = 'https://api.blazarpay.com'; // Production
// const API_BASE_URL = 'http://localhost:5000'; // Development
```

### WebSocket Configuration

Configure WebSocket server:

```javascript
// Edit src/socket.js
const io = new Server(server, {
  cors: {
    origin: 'https://your-merchant-app.com', // Production
    methods: ['GET', 'POST'],
  },
});
```

### BLE Configuration

Configure BLE settings:

```javascript
// Edit src/characteristics.js
const SERVICE_UUID = '1d4ddcb2-279d-42e2-a95a-274352a25248';
const DEVICE_NAME = 'Blazar TERM';
```

## Troubleshooting

### Common Issues

**Terminal Not Starting**:
```bash
# Check service status
sudo systemctl status blazar-terminal

# Check logs
sudo journalctl -u blazar-terminal.service -f

# Restart service
sudo systemctl restart blazar-terminal
```

**BLE Not Advertising**:
```bash
# Check Bluetooth status
sudo systemctl status bluetooth

# Restart Bluetooth
sudo systemctl restart bluetooth

# Check BLE capabilities
sudo setcap cap_net_raw+eip $(which node)
```

**WebSocket Connection Failed**:
```bash
# Check port availability
netstat -tulpn | grep :3000

# Check firewall
sudo ufw status

# Test connection
curl -I http://localhost:3000
```

**API Connection Failed**:
```bash
# Test API connectivity
curl -I https://api.blazarpay.com

# Check network
ping -c 4 8.8.8.8

# Verify API_BASE_URL
grep API_BASE_URL src/services.js
```

### Debug Mode

Enable debug logging:

```bash
# Set debug environment variable
export DEBUG=blazar-terminal:*

# Start with debug logging
npm run dev
```

### Performance Issues

**High CPU Usage**:
```bash
# Check system resources
htop

# Monitor process
ps aux | grep node

# Check system temperature
vcgencmd measure_temp
```

**Memory Issues**:
```bash
# Check memory usage
free -h

# Monitor memory
htop

# Check swap usage
swapon --show
```

## Security Best Practices

### Network Security

- Use HTTPS for API communications
- Configure firewall rules
- Use VPN for remote access
- Regular security updates

### Access Control

- Restrict SSH access
- Use key-based authentication
- Regular password changes
- Monitor access logs

### Data Protection

- Encrypt sensitive data
- Regular backups
- Secure log storage
- Access logging

## Maintenance

### Regular Updates

```bash
# Update system packages
sudo apt update && sudo apt upgrade -y

# Update Node.js dependencies
cd /opt/blazar-terminal
npm update

# Restart service after updates
sudo systemctl restart blazar-terminal
```

### Backup Configuration

```bash
# Backup configuration
sudo tar -czf blazar-terminal-backup.tar.gz /opt/blazar-terminal

# Backup system configuration
sudo tar -czf system-backup.tar.gz /etc/systemd/system/blazar-terminal.service
```

### Log Rotation

Configure log rotation:

```bash
# Edit logrotate configuration
sudo nano /etc/logrotate.d/blazar-terminal
```

Add configuration:
```
/opt/blazar-terminal/logs/*.log {
    daily
    missingok
    rotate 7
    compress
    delaycompress
    notifempty
    create 644 pi pi
}
```

## Next Steps

- **[Troubleshooting](/blazar-terminal/troubleshooting)** - Common issues and solutions
- **[Development](/blazar-terminal/development)** - Development guidelines
- **[API Integration](/blazar-terminal/api-integration)** - Backend API integration
- **[Payment Flow](/blazar-terminal/payment-flow)** - Payment processing flow
